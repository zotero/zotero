<?xml version="1.0"?>
<?xml-stylesheet href="chrome://global/skin/global.css" type="text/css"?>
<?xml-stylesheet href="chrome://zotero/skin/zotero.css" type="text/css"?>

<dialog id="deeptutor-google-auth-dialog"
        xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
        title="DeepTutor - Google Sign In"
        buttons="cancel"
        buttonlabelcancel="Cancel"
        ondialogcancel="return window.onCancel();"
        width="600"
        height="500"
        persist="width height"
        resizable="true">

    <script type="application/javascript" src="chrome://zotero/content/DeepTutorGoogleAuthScript.js"/>

    <vbox flex="1" style="padding: 15px;">
        <description style="margin-bottom: 15px; padding: 15px; background: #e8f4fd; border: 1px solid #bee5eb; border-radius: 5px; font-size: 14px;">
            <html:strong xmlns:html="http://www.w3.org/1999/xhtml">Google Authentication Required</html:strong><html:br xmlns:html="http://www.w3.org/1999/xhtml"/>
            DeepTutor will open Google's authentication page in your default browser.
            After signing in with Google, you will receive an authorization code.
            Please copy that code and paste it in the field below.
        </description>

        <browser id="auth-browser"
                 flex="1"
                 type="content-primary"
                 src="about:blank"
                 style="min-height: 200px; height: 200px; border: 1px solid #ccc; margin: 10px; display: none;"/>

        <vbox id="manual-input-container" style="margin: 10px 0; padding: 15px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px;">

            <!-- URL display section - initially hidden -->
            <vbox id="url-display-section" style="display: none; margin-bottom: 15px; padding: 15px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px;">
                <description style="font-weight: bold; margin-bottom: 8px; font-size: 14px;">
                    Please manually open this URL in your browser:
                </description>
                <textbox id="oauth-url-textbox"
                         readonly="true"
                         style="width: 100%; font-family: monospace; font-size: 11px; margin-bottom: 8px; padding: 8px; background: #ffffff; border: 1px solid #ccc; border-radius: 3px;"/>
                <button id="copy-url-button"
                        label="Copy URL"
                        oncommand="window.copyOAuthURL();"
                        style="margin-bottom: 8px;"/>
                <description style="font-size: 12px; color: #666;">
                    After opening the link and completing Google login, you will receive an authorization code. Copy that code and paste it below.
                </description>
            </vbox>

            <!-- Authorization Code Input Section -->
            <separator style="margin: 10px 0;"/>

            <description style="font-weight: bold; margin-bottom: 10px; font-size: 14px;">
                Enter Authorization Code:
            </description>

            <description style="margin-bottom: 10px; font-size: 12px; color: #666;">
                After completing authentication in your browser, Google will display an authorization code.
                Copy the entire code and paste it here:
            </description>

            <vbox style="margin: 10px 0; border: 1px solid #ccc; padding: 10px; background: #ffffff; border-radius: 3px;">
                <label value="Authorization Code:" style="margin-bottom: 5px; font-weight: bold;"/>
                <html:div xmlns:html="http://www.w3.org/1999/xhtml" style="margin: 10px 0;">
                    <html:input id="manual-code-input"
                                type="text"
                                placeholder="Paste the authorization code here..."
                                style="width: 100%; min-height: 35px; padding: 8px; font-family: monospace; border: 2px solid #007acc; margin-bottom: 10px; background: #ffffff; font-size: 14px; box-sizing: border-box;"/>
                </html:div>
                <button label="Submit Code"
                        oncommand="window.submitManualCode();"
                        style="padding: 10px 20px; background: #007acc; color: white; border: none; border-radius: 3px; font-weight: bold;"/>
            </vbox>

            <description style="font-size: 11px; color: #666; margin-top: 5px;">
                The authorization code is usually a long string of letters, numbers, and symbols.
            </description>
        </vbox>

        <hbox pack="center" style="margin-top: 15px;">
            <description style="font-size: 11px; color: #666; text-align: center;">
                If you experience any issues with the authentication process, please try refreshing your browser
                or check your internet connection.
            </description>
        </hbox>
    </vbox>

</dialog>